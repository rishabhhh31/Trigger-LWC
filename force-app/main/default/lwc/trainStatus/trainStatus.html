<template>
  <div class="slds-grid slds-wrap slds-grid_vertical-align-center">
    <div class="slds-col slds-size_8-of-12">
      <lightning-input lwc:ref="train" message-when-pattern-mismatch="train number must be a number" pattern="^\d+$"
        variant="label-hidden" label="Enter Train Number" placeholder="Enter Train Number"
        onchange={handleTrainNumberChange}>
      </lightning-input>
    </div>
    <div class="slds-col slds-size_4-of-12">
      <div class="slds-grid slds-wrap slds-var-p-around_small slds-grid_vertical-align-center">
        <div class="slds-col slds-size_8-of-12">
          <lightning-button disabled={isTrainNumberValid} label="Check Train Status" onclick={handleCheckStatus}
            variant="brand">
          </lightning-button>
        </div>
        <div class="slds-col slds-size_2-of-12">
          <lightning-button-icon disabled={isTrainNumberValid} tooltip="Refresh" variant="inverse"
            label="Check Train Status" onclick={handleCheckStatus} click={handleCheckStatus} icon-name="action:refresh">
          </lightning-button-icon>
        </div>
      </div>
    </div>
  </div>

  <lightning-spinner if:true={isLoading} alternative-text="Loading" size="small"></lightning-spinner>

  <template if:true={stationsList.length}>
    <div class="container">
      <div class="header">
        <h1 class="title"> {trainName}: <span class="train-name"><lightning-formatted-rich-text
              value={trainStatusMessage}></lightning-formatted-rich-text></span> </h1>
      </div>
      <div class="table-wrapper">
        <table class="status-table">
          <thead>
            <tr>
              <th>Station</th>
              <th>Distance (km)</th>
              <th>Platform</th>
              <th>Day</th>
              <th>Date</th>
              <th>Arr (Sched)</th>
              <th>Arr (Actual)</th>
              <th>Dep (Sched)</th>
              <th>Dep (Actual)</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <template for:each={stationsList} for:item="station">
              <tr key={station.stationCode}>
                <td class={station.stationCssClass}>{station.stationName}</td>
                <td>{station.distance}</td>
                <td>{station.platform}</td>
                <td>{station.dayCount}</td>
                <td class="nowrap">{station.formattedArrivalDate}</td>
                <td class="muted" lwc:dom="manual"></td>
                <td class="actual">{station.actualArrivalTime}</td>
                <td class="muted" lwc:dom="manual"></td>
                <td class="actual">{station.actualDepartureTime}</td>
                <td class="status-cell">
                  <span class={station.statusDotClass}></span>
                  <span class={station.statusTextClass}>{station.runningStatus}</span>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </div>
  </template>
</template>